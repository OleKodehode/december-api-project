{
  "swagger": "2.0",
  "info": {
    "version": "v1.0.0",
    "title": "Entertainment Backlog API (Service to Service)",
    "description": "A service to service API providing an Entertainment/Media backlog service"
  },
  "host": "localhost:8000",
  "basePath": "/",
  "schemes": ["http"],
  "tags": [
    {
      "name": "Health",
      "description": "Server status endpoint"
    },
    {
      "name": "Authorization",
      "description": "Endpoints related to Authorization"
    },
    {
      "name": "Entries",
      "description": "Endpoints related to main functionality of the API. Authorization Required."
    }
  ],
  "securityDefinitions": {
    "bearerAuth": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header",
      "description": "JWT Authorization header using the bearer scheme.\nExample: 'Bearer {token}'"
    },
    "refreshToken": {
      "type": "apiKey",
      "name": "x-refreshtoken",
      "in": "header",
      "description": "Refresh token for obtaining new access tokens."
    }
  },
  "paths": {
    "/v1/health": {
      "get": {
        "tags": ["Health"],
        "summary": "Server health check",
        "description": "Server status",
        "responses": {
          "200": {
            "description": "Server is up and running",
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "string",
                  "example": "ok"
                },
                "timestamp": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "404": {
            "description": "Service not found."
          }
        }
      }
    },
    "/v1/protected": {
      "get": {
        "tags": ["Authorization"],
        "summary": "Test authentication",
        "description": "A test endpoint to verify that JWT authentication is working properly",
        "security": [
          {
            "bearerAuth": [],
            "refreshToken": []
          }
        ],
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Bearer token",
            "schema": {
              "type": "string",
              "example": "Bearer <ACCESS_TOKEN>"
            }
          },
          {
            "name": "x-refreshtoken",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Refresh token",
            "schema": {
              "type": "string",
              "example": "<REFRESH_TOKEN>"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfull authentication",
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string",
                  "example": "You are authenticated"
                },
                "user": {
                  "type": "object",
                  "properties": {
                    "userId": {
                      "type": "string",
                      "example": "test-user-001"
                    },
                    "sid": {
                      "type": "string",
                      "example": "session-id-123"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid Token",
            "schema": {
              "type": "object",
              "properties": {
                "message": {
                  "type": "string",
                  "example": "Invalid or expired token"
                }
              }
            }
          }
        }
      }
    },
    "/v1/auth/login": {
      "post": {
        "tags": ["Authorization"],
        "summary": "User login",
        "description": "Route to get authorized - Requires a valid username, password.\nAs of now, requires manually adding new users into userService on the server-side.",
        "parameters": [
          {
            "name": "body",
            "in": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["username", "password"],
              "properties": {
                "username": {
                  "type": "string",
                  "example": "Test"
                },
                "password": {
                  "type": "string",
                  "example": "TestPassword123"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Successfull Login - Provides hex tokens in body.",
            "schema": {
              "type": "object",
              "properties": {
                "accessToken": {
                  "type": "string",
                  "description": "JWT Access Token"
                },
                "refreshToken": {
                  "type": "string",
                  "description": "JWT Refresh Token"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request"
          },
          "401": {
            "description": "Unauthorized"
          }
        }
      }
    },
    "/v1/auth/refresh": {
      "get": {
        "tags": ["Authorization"],
        "summary": "Refresh access token",
        "description": "Get a new access token using a valid refresh token.",
        "security": [
          {
            "refreshToken": []
          }
        ],
        "parameters": [
          {
            "name": "x-refreshtoken",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Valid refresh token"
          }
        ],
        "responses": {
          "200": {
            "description": "Token refreshed successfully",
            "schema": {
              "type": "object",
              "properties": {
                "accessToken": {
                  "type": "string",
                  "description": "New JWT Access token"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or expired refresh token"
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "tags": ["Authorization"],
        "summary": "User logout",
        "description": "Logs out the user and invalidates the refresh token",
        "security": [
          {
            "refreshToken": []
          }
        ],
        "parameters": [
          {
            "name": "x-refreshtoken",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Valid refresh token"
          }
        ],
        "responses": {
          "204": {
            "description": "No Content (Successfully logged out)"
          },
          "401": {
            "description": "Unauthorized - Invalid or missing refresh token"
          }
        }
      }
    },
    "/v1/entries/": {
      "get": {
        "tags": ["Entries"],
        "summary": "Get all entries",
        "description": "Retrieve all backlog entries for the authenticated user",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Bearer token"
          }
        ],
        "responses": {
          "200": {
            "description": "Successfully retrieved entries",
            "schema": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "id": {
                    "type": "string",
                    "example": "entry-123"
                  },
                  "userId": {
                    "type": "string",
                    "example": "test-user-001"
                  },
                  "type": {
                    "type": "string",
                    "enum": ["movie", "series", "game"],
                    "example": "movie"
                  },
                  "title": {
                    "type": "string",
                    "example": "The Matrix"
                  },
                  "status": {
                    "type": "string",
                    "enum": ["planned", "in-progress", "completed"],
                    "example": "planned"
                  },
                  "createdAt": {
                    "type": "string",
                    "format": "date-time"
                  },
                  "updatedAt": {
                    "type": "string",
                    "format": "date-time"
                  }
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - Invalid or missing token"
          }
        }
      },
      "post": {
        "tags": ["Entries"],
        "summary": "Create a new entry",
        "description": "Add a new entry to the user's backlog. The entry type determines which additional fields are available:\n\n**Movie**: releaseYear (1888+), director\n\n**Series**: releaseYear (1928+), currentSeason, currentEpisode\n\n**Game**: releaseYear (1971+), platform, playTime",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Bearer token"
          },
          {
            "name": "body",
            "in": "body",
            "required": true,
            "description": "Entry data varies based on type. See examples below for each type.",
            "schema": {
              "oneOf": [
                {
                  "title": "Movie entry",
                  "type": "object",
                  "required": ["type", "title", "status"],
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["movie"],
                      "example": "movie"
                    },
                    "title": {
                      "type": "string",
                      "minLength": 1,
                      "example": "Test Movie"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["planned", "watching", "completed", "dropped"],
                      "example": "planned"
                    },
                    "rating": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 10,
                      "nullable": true,
                      "example": 5
                    },
                    "notes": {
                      "type": "string",
                      "nullable": true,
                      "example": "Can be left empty"
                    },
                    "releaseYear": {
                      "type": "integer",
                      "minimum": 1888,
                      "nullable": true,
                      "example": 1999
                    },
                    "director": {
                      "type": "string",
                      "nullable": true,
                      "example": "Director - Can be left empty"
                    }
                  }
                },
                {
                  "title": "Series Entry",
                  "type": "object",
                  "required": ["type", "title", "status"],
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["series"],
                      "example": "series"
                    },
                    "title": {
                      "type": "string",
                      "minLength": 1,
                      "example": "Test Series"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["planned", "watching", "completed", "dropped"],
                      "example": "watching"
                    },
                    "rating": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 10,
                      "nullable": true,
                      "example": 7
                    },
                    "notes": {
                      "type": "string",
                      "nullable": true,
                      "example": "Can be left empty"
                    },
                    "releaseYear": {
                      "type": "integer",
                      "minimum": 1928,
                      "nullable": true,
                      "example": 2010
                    },
                    "currentSeason": {
                      "type": "integer",
                      "minimum": 1,
                      "nullable": true,
                      "example": 2
                    },
                    "currentEpisode": {
                      "type": "integer",
                      "minimum": 1,
                      "nullable": true,
                      "example": 3
                    }
                  }
                },
                {
                  "title": "Game Entry",
                  "type": "object",
                  "required": ["type", "title", "status"],
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["game"],
                      "example": "game"
                    },
                    "title": {
                      "type": "string",
                      "minLength": 1,
                      "example": "Test Game"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["planned", "watching", "completed", "dropped"],
                      "example": "completed"
                    },
                    "rating": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 10,
                      "nullable": true,
                      "example": 8
                    },
                    "notes": {
                      "type": "string",
                      "nullable": true,
                      "example": "Can be left empty"
                    },
                    "releaseYear": {
                      "type": "integer",
                      "minimum": 1971,
                      "nullable": true,
                      "example": 2005
                    },
                    "platform": {
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      ],
                      "nullable": true,
                      "example": [
                        "Nintendo Switch",
                        "Play Station 5",
                        "Xbox Series"
                      ]
                    },
                    "playTime": {
                      "type": "number",
                      "minimum": 0,
                      "nullable": true,
                      "example": 47.5,
                      "description": "Play time in hours"
                    }
                  }
                }
              ]
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Entry created successfully",
            "schema": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "example": "entry-123"
                },
                "userId": {
                  "type": "string",
                  "example": "test-user-001"
                },
                "type": {
                  "type": "string",
                  "example": "movie"
                },
                "title": {
                  "type": "string",
                  "example": "Test Movie"
                },
                "status": {
                  "type": "string",
                  "example": "planned"
                },
                "rating": {
                  "type": "number",
                  "nullable": true,
                  "example": 6
                },
                "notes": {
                  "type": "string",
                  "nullable": true,
                  "example": "Can be left empty"
                },
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                },
                "updatedAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid or missing required fields."
          },
          "401": {
            "description": "Unauthorized - Invalid or missing token"
          }
        }
      }
    },
    "/v1/entries/{id}": {
      "get": {
        "tags": ["Entries"],
        "summary": "Get entry by ID",
        "description": "Returns a specific entry tied to a user - Requires authorization of that specific user",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Bearer token"
          },
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Entry ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Entry retrieved successfully",
            "schema": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string",
                  "example": "entry-123"
                },
                "userId": {
                  "type": "string",
                  "example": "test-user-001"
                },
                "type": {
                  "type": "string",
                  "example": "movie"
                },
                "title": {
                  "type": "string",
                  "example": "Test Movie"
                },
                "status": {
                  "type": "string",
                  "example": "planned"
                },
                "rating": {
                  "type": "number",
                  "nullable": true,
                  "example": 6
                },
                "notes": {
                  "type": "string",
                  "nullable": true,
                  "example": "Can be left empty"
                },
                "createdAt": {
                  "type": "string",
                  "format": "date-time"
                },
                "updatedAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid entry ID"
          },
          "401": {
            "description": "Unauthorized - Invalid or missing token"
          },
          "404": {
            "description": "Not Found - Entry does not exist or does not belong to that user"
          }
        }
      },
      "patch": {
        "tags": ["Entries"],
        "summary": "update an entry",
        "description": "Updates a specific entry (Must belong to the authenticated user)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "required": true,
            "description": "Bearer token"
          },
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Entry ID"
          },
          {
            "name": "body",
            "in": "body",
            "description": "Only include fields to update. Available fields depends on the type.",
            "schema": {
              "oneOf": [
                {
                  "title": "Update movie",
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "title": {
                      "type": "string",
                      "minLength": 1,
                      "example": "Test Movie"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["planned", "watching", "completed", "dropped"],
                      "example": "planned"
                    },
                    "rating": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 10,
                      "nullable": true,
                      "example": 5
                    },
                    "notes": {
                      "type": "string",
                      "nullable": true,
                      "example": "Can be left empty"
                    },
                    "releaseYear": {
                      "type": "integer",
                      "minimum": 1888,
                      "nullable": true,
                      "example": 1999
                    },
                    "director": {
                      "type": "string",
                      "nullable": true,
                      "example": "Director - Can be left empty"
                    }
                  }
                },
                {
                  "title": "Update Series",
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "title": {
                      "type": "string",
                      "minLength": 1,
                      "example": "Test Series"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["planned", "watching", "completed", "dropped"],
                      "example": "watching"
                    },
                    "rating": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 10,
                      "nullable": true,
                      "example": 7
                    },
                    "notes": {
                      "type": "string",
                      "nullable": true,
                      "example": "Can be left empty"
                    },
                    "releaseYear": {
                      "type": "integer",
                      "minimum": 1928,
                      "nullable": true,
                      "example": 2010
                    },
                    "currentSeason": {
                      "type": "integer",
                      "minimum": 1,
                      "nullable": true,
                      "example": 2
                    },
                    "currentEpisode": {
                      "type": "integer",
                      "minimum": 1,
                      "nullable": true,
                      "example": 3
                    }
                  }
                },
                {
                  "title": "Update Game",
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "title": {
                      "type": "string",
                      "minLength": 1,
                      "example": "Test Game"
                    },
                    "status": {
                      "type": "string",
                      "enum": ["planned", "watching", "completed", "dropped"],
                      "example": "completed"
                    },
                    "rating": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 10,
                      "nullable": true,
                      "example": 8
                    },
                    "notes": {
                      "type": "string",
                      "nullable": true,
                      "example": "Can be left empty"
                    },
                    "releaseYear": {
                      "type": "integer",
                      "minimum": 1971,
                      "nullable": true,
                      "example": 2005
                    },
                    "platform": {
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      ],
                      "nullable": true,
                      "example": [
                        "Nintendo Switch",
                        "Play Station 5",
                        "Xbox Series"
                      ]
                    },
                    "playTime": {
                      "type": "number",
                      "minimum": 0,
                      "nullable": true,
                      "example": 47.5,
                      "description": "Play time in hours"
                    }
                  }
                }
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Entry updated successfully",
            "schema": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "string"
                },
                "userId": {
                  "type": "string"
                },
                "type": {
                  "type": "string"
                },
                "title": {
                  "type": "string"
                },
                "status": {
                  "type": "string"
                },
                "rating": {
                  "type": "string",
                  "nullable": true
                },
                "notes": {
                  "type": "string",
                  "nullable": true
                },
                "updatedAt": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          },
          "400": {
            "description": "Bad Request - Invalid data or unexpected fields."
          },
          "401": {
            "description": "Unauthorized - Invalid or missing token"
          },
          "404": {
            "description": "Not Found - Entry does not exist or does not belong to that user"
          }
        }
      },
      "delete": {
        "tags": ["Entries"],
        "summary": "Delete entry",
        "description": "Delete a specific backlog entry (must belond to authenticated user)",
        "security": [{ "bearerAuth": [] }],
        "parameters": [
          {
            "name": "authorization",
            "in": "header",
            "type": "string",
            "required": true,
            "description": "Bearer token"
          },
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Entry ID"
          }
        ],
        "responses": {
          "204": {
            "description": "No Content (Successfully deleted)"
          },
          "400": {
            "description": "Bad Request - Invalid entry ID"
          },
          "401": {
            "description": "Unauthorized - Invalid or missing token"
          },
          "404": {
            "description": "Not Found - Entry does not exist or does not belong to that user"
          }
        }
      }
    }
  }
}
